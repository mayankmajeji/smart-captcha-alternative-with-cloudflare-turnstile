jQuery(document).ready(function(t){"use strict";const e=document.getElementById("twp-copy-system-info");e&&window.smartctSystemInfo&&e.addEventListener("click",function(){const t=window.smartctSystemInfo,e=["Smart Cloudflare Turnstile: v"+t.plugin_version,"WordPress: v"+t.wp_version,"PHP: v"+t.php_version,"WooCommerce: "+t.wc_version,"Memory Limit: "+t.memory_limit].join("\n");function s(){const t=document.getElementById("twp-copy-system-info-msg");t&&(t.style.display="inline",setTimeout(function(){t.style.display="none"},1500))}function n(t){const e=document.createElement("textarea");e.value=t,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select();try{document.execCommand("copy"),s()}catch(t){console.error("Copy failed",t)}document.body.removeChild(e)}navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(s,function(){n(e)}):n(e)});const s=document.querySelectorAll(".faq-question"),n=document.querySelectorAll(".faq-answer");s.length&&n.length&&s.forEach(function(t,e){t.addEventListener("click",function(){const r="true"===t.getAttribute("aria-expanded");s.forEach(function(t,e){t.setAttribute("aria-expanded","false"),n[e]&&(n[e].style.display="none")}),!r&&n[e]&&(t.setAttribute("aria-expanded","true"),n[e].style.display="block")}),t.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())}),n[e]&&(n[e].style.display="none")});const r=document.querySelectorAll(".smartct-accordion-header");r.length&&r.forEach(function(t){t.addEventListener("click",function(){const t=this.closest(".smartct-accordion-item");if(!t)return;const e=t.classList.contains("open"),s=t.querySelector(".smartct-accordion-arrow");document.querySelectorAll(".smartct-accordion-item").forEach(function(t){t.classList.remove("open");const e=t.querySelector(".smartct-accordion-arrow");e&&(e.innerHTML="&#9660;")}),e||(t.classList.add("open"),s&&(s.innerHTML="&#9650;"))})}),t(document).on("click",".twp-collapse-btn[data-twp-toggle='vtabs']",function(){const e=t(this).closest(".twp-2col");e.length&&e.toggleClass("is-collapsed")}),t("#smartct_debug_mode").on("change",function(){const e=t(".smartct-debug-section");t(this).is(":checked")?e.slideDown():e.slideUp()}),t("#smartct_show_for_logged_in").on("change",function(){const e=t(".smartct-logged-in-section");t(this).is(":checked")?e.slideDown():e.slideUp()});let a=null;function i(){const e=t('input[name="smartct_settings[smartct_site_key]"]'),s=e.length?e.val():"";return!s&&window.smartct&&window.smartct.siteKey?window.smartct.siteKey:s}window.smartctTokenCallback=function(e){a=e,t("#smartct-verify-keys").prop("disabled",!e)},t("#cf-turnstile-preview").length&&void 0!==window.turnstile&&window.turnstile.render("#cf-turnstile-preview",{sitekey:i(),theme:"auto",callback:window.smartctTokenCallback}),t(document).on("click","#smartct-verify-keys",function(e){e.preventDefault();const s=i(),n=function(){const e=t('input[name="smartct_settings[smartct_secret_key]"]'),s=e.length?e.val():"";return!s&&window.smartct&&window.smartct.secretKey?window.smartct.secretKey:s}();if(!s||!n)return void t(".smartct-verification-status .message").text("Please enter both Site Key and Secret Key.").addClass("error");if(!a)return void t(".smartct-verification-status .message").text("Please complete the Turnstile challenge.").addClass("error");const r=t(this),o=t(".smartct-verification-status"),c=o.find(".message"),d=o.find(".status-indicator"),l=t('input[name="smartct_settings[smartct_site_key]"]'),m=t('input[name="smartct_settings[smartct_secret_key]"]'),u=t(".smartct-preview-box");r.after('<span class="smartct-spinner"></span>'),r.prop("disabled",!0),c.removeClass("error success").text(""),t.ajax({url:window.smartct?window.smartct.ajaxurl:ajaxurl,type:"POST",data:{action:"smartct_verify_keys",nonce:window.smartct?window.smartct.nonce:"",site_key:s,secret_key:n,response:a},success(t){t.success?(d.removeClass("unverified").addClass("verified").text("Keys Verified"),c.removeClass("error").addClass("success").html('<div class="twp-status-indicator-box verified"><span class="twp-status-indicator" style="color:#46b450;font-weight:bold;"><span class="dashicons dashicons-yes-alt"></span>Success! Turnstile is working correctly with your API keys.</span></div>'),u.html('<div class="twp-status-indicator-box verified"><span class="twp-status-indicator" style="color:#46b450;font-weight:bold;"><span class="dashicons dashicons-yes-alt"></span>Success! Turnstile is working correctly with your API keys.</span></div>'),l.prop("readonly",!0),m.prop("readonly",!0)):(d.removeClass("verified").addClass("unverified").text("Keys Not Verified"),c.text(t.data.message).addClass("error"))},error(){d.removeClass("verified").addClass("unverified").text("Keys Not Verified"),c.text("Verification failed. Please try again.").addClass("error")},complete(){o.find(".smartct-spinner").remove(),r.prop("disabled",!1),window.turnstile&&t(".cf-turnstile").length&&window.turnstile.reset(),a=null,t("#smartct-verify-keys").prop("disabled",!0)}})}),t(document).on("click","#smartct-remove-keys",function(e){e.preventDefault();const s=t(this),n=t(".smartct-verification-status"),r=n.find(".spinner"),a=n.find(".message"),i=n.find(".status-indicator"),o=t('input[name="smartct_settings[smartct_site_key]"]'),c=t('input[name="smartct_settings[smartct_secret_key]"]');r.addClass("is-active"),s.prop("disabled",!0),a.removeClass("error success").text(""),t.ajax({url:window.smartct?window.smartct.ajaxurl:ajaxurl,type:"POST",data:{action:"smartct_remove_keys",nonce:window.smartct?window.smartct.nonce:""},success(t){t.success?(i.removeClass("verified").addClass("unverified").text("Keys Not Verified"),a.text(t.data.message).addClass("success"),o.val("").prop("readonly",!1),c.val("").prop("readonly",!1),s.replaceWith('<button type="button" class="button button-secondary" id="smartct-verify-keys">Verify Keys</button>')):a.text(t.data.message).addClass("error")},error(){a.text("Key removal failed.").addClass("error")},complete(){r.removeClass("is-active"),s.prop("disabled",!1)}})})});