<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>TurnstileWP-Documentation</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      border: none;
      border-top: 1px solid #1a1a1a;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
</head>
<body>
<h1 id="turnstilewp-plugin-documentation">TurnstileWP Plugin
Documentation</h1>
<h2 id="overview">Overview</h2>
<p>TurnstileWP is a WordPress plugin that integrates Cloudflare
Turnstile CAPTCHA protection with WordPress forms. It provides
lightweight and privacy-first protection for login, registration,
password reset, comments, and WooCommerce forms.</p>
<p><strong>Plugin Details:</strong></p>
<ul>
<li>Version: 1.0.0</li>
<li>Requires WordPress: 5.8+</li>
<li>Requires PHP: 7.4+</li>
<li>Author: Mayank Majeji</li>
<li>License: GPL v2 or later</li>
</ul>
<h2 id="plugin-architecture">Plugin Architecture</h2>
<h3 id="main-files-structure">Main Files Structure</h3>
<pre><code>turnstilewp/
├── turnstilewp.php                 - Main plugin file
├── includes/                       - Core plugin classes
│   ├── class-init.php             - Plugin initialization
│   ├── class-loader.php           - Autoloader
│   ├── class-settings.php         - Settings management
│   ├── class-verify.php           - Token verification
│   ├── class-ajax-handlers.php    - AJAX functionality
│   ├── functions-common.php       - Common utility functions
│   └── settings/                  - Settings framework
├── integrations/                  - Form integrations
│   ├── class-turnstile.php       - Main Turnstile widget
│   ├── class-core-wp.php         - WordPress core forms
│   └── class-woocommerce.php     - WooCommerce integration
├── admin/                         - Admin interface
├── templates/                     - Template files
└── assets/                        - CSS/JS assets</code></pre>
<h2 id="core-functions-documentation">Core Functions Documentation</h2>
<h3 id="main-plugin-file-turnstilewp.php">1. Main Plugin File
(<code>turnstilewp.php</code>)</h3>
<h4 id="global-functions">Global Functions</h4>
<h5 id="turnstilewp_init"><code>turnstilewp_init()</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize the plugin after WordPress
loads</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Loads text domain, initializes the
main plugin class as singleton</li>
<li><strong>Hook</strong>: <code>plugins_loaded</code></li>
</ul>
<h5 id="anonymous-activation-hook-function">Anonymous Activation Hook
Function</h5>
<ul>
<li><strong>Purpose</strong>: Handle plugin activation</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Requires the Init class and calls the
activate method</li>
</ul>
<h5 id="anonymous-deactivation-hook-function">Anonymous Deactivation
Hook Function</h5>
<ul>
<li><strong>Purpose</strong>: Handle plugin deactivation</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Requires the Init class and calls the
deactivate method</li>
</ul>
<h4 id="global-constants">Global Constants</h4>
<ul>
<li><code>TURNSTILEWP_VERSION</code>: Plugin version (1.0.0)</li>
<li><code>TURNSTILEWP_PLUGIN_DIR</code>: Plugin directory path</li>
<li><code>TURNSTILEWP_PLUGIN_URL</code>: Plugin URL</li>
<li><code>TURNSTILEWP_PLUGIN_BASENAME</code>: Plugin basename</li>
</ul>
<hr />
<h3 id="init-class-includesclass-init.php">2. Init Class
(<code>includes/class-init.php</code>)</h3>
<h4 id="class-properties">Class Properties</h4>
<ul>
<li><code>$settings</code>: Settings instance</li>
<li><code>$verify</code>: Verify instance</li>
<li><code>$ajax_handlers</code>: AJAX handlers instance</li>
<li><code>$admin_hooks_registered</code>: Static flag to prevent
duplicate admin hooks</li>
<li><code>$instance</code>: Singleton instance</li>
</ul>
<h4 id="methods">Methods</h4>
<h5 id="get_instance-init"><code>get_instance(): Init</code></h5>
<ul>
<li><strong>Purpose</strong>: Get singleton instance of the Init
class</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: Init instance</li>
<li><strong>Description</strong>: Implements singleton pattern for
plugin initialization</li>
</ul>
<h5 id="init-void"><code>init(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize the plugin components</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Loads dependencies, initializes
components, sets up integrations and hooks</li>
</ul>
<h5
id="load_dependencies-void"><code>load_dependencies(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Load required plugin dependencies</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Includes common functions file</li>
</ul>
<h5 id="init_hooks-void"><code>init_hooks(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize WordPress hooks</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Sets up admin and frontend hooks for
the plugin</li>
</ul>
<h5
id="enqueue_admin_assets-void"><code>enqueue_admin_assets(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Enqueue admin-specific CSS and
JavaScript</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Loads admin styles, Turnstile API
script, and admin settings JavaScript on plugin pages</li>
</ul>
<h5
id="enqueue_frontend_assets-void"><code>enqueue_frontend_assets(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Enqueue frontend CSS and JavaScript</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Loads Turnstile API script and
frontend styles when needed</li>
</ul>
<h5
id="should_load_turnstile-bool"><code>should_load_turnstile(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Determine if Turnstile should be loaded on
current page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Whether to load Turnstile</li>
<li><strong>Description</strong>: Checks user login status, page type,
and settings to determine if Turnstile is needed</li>
</ul>
<h5 id="activate-void"><code>activate(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Handle plugin activation tasks</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Initializes settings and adds default
options</li>
</ul>
<h5 id="deactivate-void"><code>deactivate(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Handle plugin deactivation tasks</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Placeholder for cleanup tasks</li>
</ul>
<h5
id="verify_keys_ajax-void"><code>verify_keys_ajax(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Handle AJAX request for key
verification</li>
<li><strong>Parameters</strong>: None (uses $_POST data)</li>
<li><strong>Returns</strong>: void (outputs JSON)</li>
<li><strong>Description</strong>: Verifies Cloudflare API keys via
AJAX</li>
</ul>
<h5
id="remove_keys_ajax-void"><code>remove_keys_ajax(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Handle AJAX request for removing API
keys</li>
<li><strong>Parameters</strong>: None (uses $_POST data)</li>
<li><strong>Returns</strong>: void (outputs JSON)</li>
<li><strong>Description</strong>: Removes stored API keys and
verification status</li>
</ul>
<h5 id="get_client_ip-string"><code>get_client_ip(): string</code></h5>
<ul>
<li><strong>Purpose</strong>: Get client IP address</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: string - Client IP address</li>
<li><strong>Description</strong>: Extracts client IP from various server
headers</li>
</ul>
<h5
id="init_integrations-void"><code>init_integrations(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize form integrations</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Creates instances of Core_WP and
WooCommerce integration classes</li>
</ul>
<hr />
<h3 id="loader-class-includesclass-loader.php">3. Loader Class
(<code>includes/class-loader.php</code>)</h3>
<h4 id="static-methods">Static Methods</h4>
<h5 id="register-void"><code>register(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Register the autoloader and load
integrations</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Registers SPL autoloader and loads all
integration files</li>
</ul>
<h5
id="autoloadstring-class-void"><code>autoload(string $class): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Autoload classes in the TurnstileWP
namespace</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$class</code>: Full class name including namespace</li>
</ul></li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Converts class names to file paths and
loads class files</li>
</ul>
<h5
id="load_integrations-void"><code>load_integrations(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Load all integration class files</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Automatically includes all class files
in the integrations directory</li>
</ul>
<hr />
<h3 id="settings-class-includesclass-settings.php">4. Settings Class
(<code>includes/class-settings.php</code>)</h3>
<h4 id="class-properties-1">Class Properties</h4>
<ul>
<li><code>OPTION_NAME</code>: WordPress option name
(‘turnstilewp_settings’)</li>
<li><code>$defaults</code>: Array of default setting values</li>
<li><code>$fields</code>: Centralized settings fields array</li>
</ul>
<h4 id="methods-1">Methods</h4>
<h5 id="construct"><code>__construct()</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize settings class</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Description</strong>: Adds default options and registers
centralized fields</li>
</ul>
<h5 id="get_settings-array"><code>get_settings(): array</code></h5>
<ul>
<li><strong>Purpose</strong>: Get all plugin settings</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: array - All plugin settings merged with
defaults</li>
<li><strong>Description</strong>: Retrieves settings from WordPress
options table</li>
</ul>
<h5
id="get_optionstring-key-default-null"><code>get_option(string $key, $default = null)</code></h5>
<ul>
<li><strong>Purpose</strong>: Get a specific setting value</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$key</code>: Setting key name</li>
<li><code>$default</code>: Default value if not found</li>
</ul></li>
<li><strong>Returns</strong>: mixed - Setting value or default</li>
<li><strong>Description</strong>: Retrieves individual setting
value</li>
</ul>
<h5
id="add_default_options-void"><code>add_default_options(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Add default options to database</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Creates initial settings in WordPress
options table</li>
</ul>
<h5
id="register_settings-void"><code>register_settings(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Register settings with WordPress Settings
API</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Registers the main settings group with
sanitization callback</li>
</ul>
<h5
id="sanitize_settingsarray-input-array"><code>sanitize_settings(array $input): array</code></h5>
<ul>
<li><strong>Purpose</strong>: Sanitize settings input</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$input</code>: Raw input array from form submission</li>
</ul></li>
<li><strong>Returns</strong>: array - Sanitized settings array</li>
<li><strong>Description</strong>: Validates and sanitizes all setting
values based on field types</li>
</ul>
<h5 id="add_admin_menu-void"><code>add_admin_menu(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Add admin menu pages</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Creates main menu and submenu pages
for the plugin</li>
</ul>
<h5
id="render_dashboard_page-void"><code>render_dashboard_page(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render the dashboard page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Includes dashboard template file</li>
</ul>
<h5
id="render_integrations_page-void"><code>render_integrations_page(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render the integrations page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Includes integrations template
file</li>
</ul>
<h5
id="render_settings_main_page-void"><code>render_settings_main_page(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render the main settings page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Includes settings template file</li>
</ul>
<h5
id="render_tools_page-void"><code>render_tools_page(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render the tools page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Includes tools template file</li>
</ul>
<h5
id="render_faqs_page-void"><code>render_faqs_page(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render the FAQs page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Includes FAQs template file</li>
</ul>
<h5
id="register_centralized_fields-void"><code>register_centralized_fields(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Register all settings fields in
centralized system</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Sets up the organized field structure
for settings</li>
</ul>
<h5
id="organize_fieldsarray-fields-array"><code>organize_fields(array $fields): array</code></h5>
<ul>
<li><strong>Purpose</strong>: Organize fields by tabs and sections</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$fields</code>: Array of field definitions</li>
</ul></li>
<li><strong>Returns</strong>: array - Organized field structure</li>
<li><strong>Description</strong>: Groups fields into hierarchical
structure for rendering</li>
</ul>
<h5
id="get_fields_structure-array"><code>get_fields_structure(): array</code></h5>
<ul>
<li><strong>Purpose</strong>: Get the organized fields structure</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: array - Organized fields by tab and
section</li>
<li><strong>Description</strong>: Returns the complete field
organization for rendering</li>
</ul>
<hr />
<h3 id="verify-class-includesclass-verify.php">5. Verify Class
(<code>includes/class-verify.php</code>)</h3>
<h4 id="class-properties-2">Class Properties</h4>
<ul>
<li><code>$settings</code>: Settings instance</li>
</ul>
<h4 id="methods-2">Methods</h4>
<h5 id="construct-1"><code>__construct()</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize verification class</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Description</strong>: Creates Settings instance for
accessing configuration</li>
</ul>
<h5
id="verify_tokenstring-token-string-custom_secret_key-null-bool"><code>verify_token(string $token, ?string $custom_secret_key = null): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile token with Cloudflare
API</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$token</code>: Turnstile response token</li>
<li><code>$custom_secret_key</code>: Optional custom secret key for
admin verification</li>
</ul></li>
<li><strong>Returns</strong>: bool - Whether verification was
successful</li>
<li><strong>Description</strong>: Sends verification request to
Cloudflare Turnstile API</li>
</ul>
<h5
id="get_client_ip-string-1"><code>get_client_ip(): string</code></h5>
<ul>
<li><strong>Purpose</strong>: Get client IP address for
verification</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: string - Client IP address</li>
<li><strong>Description</strong>: Extracts client IP from various server
headers</li>
</ul>
<h5
id="log_errorstring-message-void"><code>log_error(string $message): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Log error messages when debug mode is
enabled</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$message</code>: Error message to log</li>
</ul></li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Writes error messages to WordPress
error log if debug mode is active</li>
</ul>
<hr />
<h3 id="ajax-handlers-class-includesclass-ajax-handlers.php">6. Ajax
Handlers Class (<code>includes/class-ajax-handlers.php</code>)</h3>
<h4 id="methods-3">Methods</h4>
<h5 id="construct-2"><code>__construct()</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize AJAX handlers</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Description</strong>: Registers AJAX action hooks</li>
</ul>
<h5 id="export_settings-void"><code>export_settings(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Export plugin settings as JSON file</li>
<li><strong>Parameters</strong>: None (uses $_GET data)</li>
<li><strong>Returns</strong>: void (outputs file download)</li>
<li><strong>Description</strong>: Verifies permissions and nonce, then
exports settings as downloadable JSON</li>
</ul>
<hr />
<h3 id="common-functions-includesfunctions-common.php">7. Common
Functions (<code>includes/functions-common.php</code>)</h3>
<h4 id="utility-functions">Utility Functions</h4>
<h5 id="is_login-bool"><code>is_login(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Check if current page is login page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Whether on login page</li>
<li><strong>Description</strong>: Determines if user is on
wp-login.php</li>
</ul>
<h5
id="is_registration_page-bool"><code>is_registration_page(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Check if current page is registration
page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Whether on registration page</li>
<li><strong>Description</strong>: Checks for wp-login.php with register
action</li>
</ul>
<h5
id="is_lost_password_page-bool"><code>is_lost_password_page(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Check if current page is lost password
page</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Whether on lost password page</li>
<li><strong>Description</strong>: Checks for wp-login.php with
lostpassword action</li>
</ul>
<h5
id="is_comment_form_page-bool"><code>is_comment_form_page(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Check if current page has comment
form</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Whether page has comment form</li>
<li><strong>Description</strong>: Determines if page is singular and
comments are open</li>
</ul>
<hr />
<h3 id="turnstile-integration-class-integrationsclass-turnstile.php">8.
Turnstile Integration Class
(<code>integrations/class-turnstile.php</code>)</h3>
<h4 id="class-properties-3">Class Properties</h4>
<ul>
<li><code>$settings</code>: Settings instance</li>
</ul>
<h4 id="methods-4">Methods</h4>
<h5 id="construct-3"><code>__construct()</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize Turnstile integration</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Description</strong>: Creates Settings instance and hooks
into WordPress actions</li>
</ul>
<h5 id="enqueue_script-void"><code>enqueue_script(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Enqueue Turnstile JavaScript API</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Loads Cloudflare Turnstile script when
site key is configured</li>
</ul>
<h5
id="renderstring-action-void"><code>render(string $action): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render Turnstile widget</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$action</code>: Action name for the widget</li>
</ul></li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Outputs Turnstile widget HTML with
configured settings</li>
</ul>
<h5
id="verifystring-token-null-bool"><code>verify(?string $token = null): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile response token</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$token</code>: Optional token (uses POST data if not
provided)</li>
</ul></li>
<li><strong>Returns</strong>: bool - Verification result</li>
<li><strong>Description</strong>: Verifies token with Cloudflare
API</li>
</ul>
<h5
id="render_dynamicarray-args-void"><code>render_dynamic(array $args = []): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render Turnstile widget with dynamic
configuration</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$args</code>: Array of rendering arguments</li>
</ul></li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Renders widget with customizable
attributes and hooks</li>
</ul>
<hr />
<h3 id="core-wordpress-integration-integrationsclass-core-wp.php">9.
Core WordPress Integration
(<code>integrations/class-core-wp.php</code>)</h3>
<h4 id="class-properties-4">Class Properties</h4>
<ul>
<li><code>$settings</code>: Settings instance</li>
<li><code>$verify</code>: Verify instance</li>
</ul>
<h4 id="methods-5">Methods</h4>
<h5 id="construct-4"><code>__construct()</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize WordPress core integration</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Description</strong>: Sets up Settings and Verify instances,
initializes hooks</li>
</ul>
<h5 id="init_hooks-void-1"><code>init_hooks(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize hooks for WordPress core
forms</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Sets up hooks for login, registration,
password reset, and comment forms</li>
</ul>
<h5
id="render_turnstile_field-void"><code>render_turnstile_field(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render Turnstile field for core WordPress
forms</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Outputs Turnstile widget if keys are
verified and conditions are met</li>
</ul>
<h5
id="get_form_context-string"><code>get_form_context(): string</code></h5>
<ul>
<li><strong>Purpose</strong>: Determine current form context</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: string - Form context identifier</li>
<li><strong>Description</strong>: Uses current filter to identify which
form is being processed</li>
</ul>
<h5
id="verify_loginuser-string-username-string-password"><code>verify_login($user, string $username, string $password)</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for login attempts</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$user</code>: User object or WP_Error from previous
callbacks</li>
<li><code>$username</code>: Username being verified</li>
<li><code>$password</code>: Password being verified</li>
</ul></li>
<li><strong>Returns</strong>: WP_User|WP_Error - User object or
error</li>
<li><strong>Description</strong>: Validates Turnstile token during login
process</li>
</ul>
<h5
id="verify_registrationwp_error-errors-string-sanitized_user_login-string-user_email-wp_error"><code>verify_registration(\WP_Error $errors, string $sanitized_user_login, string $user_email): \WP_Error</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for user
registration</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$errors</code>: Existing registration errors</li>
<li><code>$sanitized_user_login</code>: Sanitized username</li>
<li><code>$user_email</code>: User email address</li>
</ul></li>
<li><strong>Returns</strong>: WP_Error - Updated errors object</li>
<li><strong>Description</strong>: Adds Turnstile verification to
registration process</li>
</ul>
<h5
id="verify_lost_passwordwp_error-errors-wp_error"><code>verify_lost_password(\WP_Error $errors): \WP_Error</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for password reset
requests</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$errors</code>: Existing password reset errors</li>
</ul></li>
<li><strong>Returns</strong>: WP_Error - Updated errors object</li>
<li><strong>Description</strong>: Validates Turnstile token for password
reset</li>
</ul>
<h5
id="verify_commentarray-commentdata-array"><code>verify_comment(array $commentdata): array</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for comment
submissions</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$commentdata</code>: Comment data array</li>
</ul></li>
<li><strong>Returns</strong>: array - Comment data (unchanged if
valid)</li>
<li><strong>Description</strong>: Validates Turnstile token before
processing comments</li>
</ul>
<h5 id="verify_token-bool"><code>verify_token(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile token from POST data</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Verification result</li>
<li><strong>Description</strong>: Helper method to verify token using
Verify class</li>
</ul>
<h5
id="should_show_turnstile-bool"><code>should_show_turnstile(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Check if Turnstile should be
displayed</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Whether to show Turnstile</li>
<li><strong>Description</strong>: Considers user login status and
settings to determine display</li>
</ul>
<hr />
<h3 id="woocommerce-integration-integrationsclass-woocommerce.php">10.
WooCommerce Integration
(<code>integrations/class-woocommerce.php</code>)</h3>
<h4 id="class-properties-5">Class Properties</h4>
<ul>
<li><code>$settings</code>: Settings instance</li>
</ul>
<h4 id="methods-6">Methods</h4>
<h5 id="construct-5"><code>__construct()</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize WooCommerce integration</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Description</strong>: Sets up Settings instance, registers
fields, and initializes hooks</li>
</ul>
<h5
id="register_settings_fields-void"><code>register_settings_fields(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Register WooCommerce-specific settings
fields</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Adds WooCommerce form integration
settings to centralized system</li>
</ul>
<h5 id="init_hooks-void-2"><code>init_hooks(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Initialize WooCommerce form hooks</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Sets up hooks for various WooCommerce
forms based on settings</li>
</ul>
<h5
id="add_checkout_hooksstring-location-void"><code>add_checkout_hooks(string $location): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Add checkout hooks based on selected
location</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$location</code>: Where to place the Turnstile widget on
checkout</li>
</ul></li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Hooks into appropriate WooCommerce
checkout actions</li>
</ul>
<h5
id="render_turnstile-void"><code>render_turnstile(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Render Turnstile widget for WooCommerce
forms</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Outputs Turnstile widget if keys are
verified</li>
</ul>
<h5 id="verify_token-bool-1"><code>verify_token(): bool</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile token</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: bool - Verification result</li>
<li><strong>Description</strong>: Helper method to verify token using
Verify class</li>
</ul>
<h5
id="verify_turnstilevalidation_error-username-password-wp_error"><code>verify_turnstile($validation_error, $username, $password): \WP_Error</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for WooCommerce
login</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$validation_error</code>: Existing validation errors</li>
<li><code>$username</code>: Login username</li>
<li><code>$password</code>: Login password</li>
</ul></li>
<li><strong>Returns</strong>: WP_Error - Updated validation errors</li>
<li><strong>Description</strong>: Adds Turnstile verification to
WooCommerce login</li>
</ul>
<h5
id="verify_turnstile_registrationerrors-username-email-wp_error"><code>verify_turnstile_registration($errors, $username, $email): \WP_Error</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for WooCommerce
registration</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$errors</code>: Existing registration errors</li>
<li><code>$username</code>: Registration username</li>
<li><code>$email</code>: Registration email</li>
</ul></li>
<li><strong>Returns</strong>: WP_Error - Updated errors</li>
<li><strong>Description</strong>: Validates Turnstile for WooCommerce
user registration</li>
</ul>
<h5
id="verify_turnstile_reset_passworderrors-user_data-wp_error"><code>verify_turnstile_reset_password($errors, $user_data): \WP_Error</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for WooCommerce password
reset</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$errors</code>: Existing reset errors</li>
<li><code>$user_data</code>: User data for reset</li>
</ul></li>
<li><strong>Returns</strong>: WP_Error - Updated errors</li>
<li><strong>Description</strong>: Validates Turnstile for password reset
requests</li>
</ul>
<h5
id="verify_turnstile_checkout-void"><code>verify_turnstile_checkout(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for WooCommerce
checkout</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Validates Turnstile during checkout
process, adds error if failed</li>
</ul>
<h5
id="verify_turnstile_pay_order-void"><code>verify_turnstile_pay_order(): void</code></h5>
<ul>
<li><strong>Purpose</strong>: Verify Turnstile for pay-for-order
process</li>
<li><strong>Parameters</strong>: None</li>
<li><strong>Returns</strong>: void</li>
<li><strong>Description</strong>: Validates Turnstile when paying for
existing orders</li>
</ul>
<hr />
<h3 id="field-renderer-includessettingsfield-renderer.php">11. Field
Renderer (<code>includes/settings/field-renderer.php</code>)</h3>
<h4 id="functions">Functions</h4>
<h5
id="render_setting_fieldfield-value"><code>render_setting_field($field, $value)</code></h5>
<ul>
<li><strong>Purpose</strong>: Render individual settings field</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$field</code>: Field configuration array</li>
<li><code>$value</code>: Current field value</li>
</ul></li>
<li><strong>Returns</strong>: void (outputs HTML)</li>
<li><strong>Description</strong>: Renders form fields based on type
(text, checkbox, select, etc.)</li>
</ul>
<h5
id="render_setting_fields_groupedfields-values"><code>render_setting_fields_grouped($fields, $values)</code></h5>
<ul>
<li><strong>Purpose</strong>: Render grouped settings fields</li>
<li><strong>Parameters</strong>:
<ul>
<li><code>$fields</code>: Array of field configurations</li>
<li><code>$values</code>: Array of current values</li>
</ul></li>
<li><strong>Returns</strong>: void (outputs HTML)</li>
<li><strong>Description</strong>: Renders fields in groups with
appropriate titles and containers</li>
</ul>
<hr />
<h2 id="settings-field-types">Settings Field Types</h2>
<p>The plugin supports various field types for the settings system:</p>
<h3 id="field-types">Field Types</h3>
<ol type="1">
<li><strong>text</strong> - Standard text input</li>
<li><strong>password</strong> - Password input (masked)</li>
<li><strong>email</strong> - Email input with validation</li>
<li><strong>url</strong> - URL input with validation</li>
<li><strong>number</strong> - Numeric input</li>
<li><strong>checkbox</strong> - Boolean checkbox with toggle
styling</li>
<li><strong>select</strong> - Dropdown selection</li>
<li><strong>textarea</strong> - Multi-line text input</li>
<li><strong>content</strong> - Static content display</li>
</ol>
<h3 id="field-configuration">Field Configuration</h3>
<p>Each field can have the following properties:</p>
<ul>
<li><code>field_id</code>: Unique identifier</li>
<li><code>label</code>: Display label</li>
<li><code>description</code>: Help text</li>
<li><code>type</code>: Field type</li>
<li><code>default</code>: Default value</li>
<li><code>options</code>: Options for select fields</li>
<li><code>tab</code>: Settings tab</li>
<li><code>section</code>: Settings section</li>
<li><code>group</code>: Field group</li>
<li><code>priority</code>: Display order</li>
<li><code>sanitize_callback</code>: Custom sanitization function</li>
</ul>
<hr />
<h2 id="hooks-and-filters">Hooks and Filters</h2>
<h3 id="actions">Actions</h3>
<ul>
<li><code>turnstilewp_before_field</code>: Before widget rendering</li>
<li><code>turnstilewp_after_field</code>: After widget rendering</li>
<li>Various WordPress core hooks for form integration</li>
</ul>
<h3 id="filters">Filters</h3>
<ul>
<li><code>turnstilewp_settings</code>: Add/modify settings fields</li>
<li><code>turnstilewp_widget_disable</code>: Conditionally disable
widget</li>
<li><code>turnstilewp_should_show</code>: Control widget display</li>
</ul>
<hr />
<h2 id="security-features">Security Features</h2>
<h3 id="token-verification">Token Verification</h3>
<ul>
<li>Server-side verification with Cloudflare API</li>
<li>IP address validation</li>
<li>Nonce verification for admin actions</li>
<li>Input sanitization and validation</li>
</ul>
<h3 id="data-protection">Data Protection</h3>
<ul>
<li>Sensitive data handling (secret keys)</li>
<li>Debug logging controls</li>
<li>Secure AJAX endpoints</li>
<li>WordPress capability checks</li>
</ul>
<hr />
<h2 id="error-handling">Error Handling</h2>
<h3 id="debug-mode">Debug Mode</h3>
<ul>
<li>Configurable debug logging</li>
<li>Error message customization</li>
<li>Detailed verification logs</li>
<li>Admin notification system</li>
</ul>
<h3 id="fallback-behavior">Fallback Behavior</h3>
<ul>
<li>Graceful degradation when API is unavailable</li>
<li>User-friendly error messages</li>
<li>Automatic retry mechanisms</li>
<li>Admin tools for troubleshooting</li>
</ul>
<hr />
<h2 id="extensibility">Extensibility</h2>
<h3 id="developer-hooks">Developer Hooks</h3>
<p>The plugin provides numerous hooks for customization:</p>
<ul>
<li>Field rendering hooks</li>
<li>Verification process hooks</li>
<li>Settings modification filters</li>
<li>Widget display controls</li>
</ul>
<h3 id="integration-framework">Integration Framework</h3>
<ul>
<li>Modular integration system</li>
<li>Easy addition of new form types</li>
<li>Standardized verification process</li>
<li>Consistent widget rendering</li>
</ul>
<hr />
<h2 id="database-schema">Database Schema</h2>
<h3 id="options-table">Options Table</h3>
<ul>
<li><code>turnstilewp_settings</code>: Main plugin settings</li>
<li><code>turnstilewp_keys_verified</code>: Key verification status</li>
</ul>
<h3 id="transients">Transients</h3>
<ul>
<li><code>turnstilewp_debug_log</code>: Debug logging data</li>
</ul>
<hr />
<p>This documentation covers all major functions and classes in the
TurnstileWP plugin. Each function is documented with its purpose,
parameters, return values, and functionality to provide a complete
reference for developers and users working with this plugin.</p>
</body>
</html>
